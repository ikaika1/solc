# Require pnpm on PATH; otherwise skip to not block commit
if ! command -v pnpm >/dev/null 2>&1; then
  echo "[husky] pnpm not found in PATH; skipping install/build"
  exit 0
fi

# If pnpm version mismatches pinned version, skip to avoid failures
REQUIRED_PNPM="9.3.0"
PNPM_VER="$(pnpm -v 2>/dev/null || echo unknown)"
if [ "$PNPM_VER" != "$REQUIRED_PNPM" ]; then
  echo "[husky] pnpm $REQUIRED_PNPM required (found $PNPM_VER); skipping install/build"
  exit 0
fi

# Light install to satisfy local hooks; fall back to full if needed
pnpm install --ignore-scripts --frozen-lockfile || pnpm install || true

# Build the target package; do not fail commit if turbo is missing
npx turbo build -F @epics-dao/solv || true
